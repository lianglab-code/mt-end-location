%% Test 1: correctness
ng = 20;
% 1
% g = rand(1,ng);
% 2
% g = 1:ng;
% 3
g = ones(1,ng);
r = 3;

x = 1:ng;
plot(x,g,'ro--');
grid on;
hold on;

g2 = filter_minmax_1d(g,'min',r);
plot(x,g2,'ko-');
plot(reshape(repmat(x,[3,1]),[1,3*ng]),...
     reshape([g;g2;nan(1,ng)],[1,3*ng]),'b-');

g3 = filter_minmax_1d(g,'max',r);
plot(x,g3,'ko-');
plot(reshape(repmat(x,[3,1]),[1,3*ng]),...
     reshape([g;g3;nan(1,ng)],[1,3*ng]),'g-');


%% Test 2: performance

eff = zeros(16,11);

for round = 1:4
    for s = 1:16
        ng = 20*2^s;
        for r = 1:11
            g = rand(ng,1);
            tic;
            g2 = filter_minmax_1d(g,'min',r);
            g3 = filter_minmax_1d(g,'max',r);
            tmp = toc;
            eff(s,r) = tmp + eff(s,r);
        end
    end
end

eff = eff/4;

figure;hold on;
for ii = 1:11
    plot((1:16)',log(eff(:,ii)),'ro-');
end

% conclusion: independent of r, linear dependent of ng
% eff
% 0.004537 0.000179 0.0006705 0.00062025 0.00062425 0.0006355 0.00064625 0.00063025 0.0006485 0.00065 0.0006555
% 0.00061925 0.00011625 0.00059825 0.00060025 0.000618 0.0006145 0.000615 0.00062175 0.000637 0.000639 0.00067325
% 0.0006065 0.000138 0.000623 0.00062775 0.00062925 0.0006505 0.00063 0.0006375 0.00065075 0.00065875 0.000667
% 0.00062975 0.0001755 0.0006435 0.00065325 0.00069125 0.000676 0.0006855 0.00066775 0.0006765 0.0006825 0.000693
% 0.000701 0.000252 0.00071675 0.00072525 0.00073375 0.0007355 0.00074975 0.0007375 0.000755 0.00075375 0.0007665
% 0.0008585 0.00040825 0.00086925 0.0008795 0.0008795 0.00089075 0.0008785 0.00087975 0.00089375 0.00089425 0.00092725
% 0.001196 0.000711 0.0011815 0.00117575 0.00116925 0.00116825 0.00117325 0.001177 0.0011865 0.00120125 0.00119325
% 0.001799 0.001293 0.0017735 0.00177 0.00177425 0.0017525 0.00174975 0.0017475 0.001751 0.00175225 0.001731
% 0.00301325 0.00243125 0.0029425 0.00289275 0.0028835 0.00289975 0.00286725 0.00286775 0.00285975 0.002866 0.00285975
% 0.0054215 0.00482375 0.00564175 0.005405 0.0053085 0.005288 0.00566325 0.00588 0.00580325 0.00522175 0.00517325
% 0.012369 0.0116145 0.01218625 0.0115905 0.0113935 0.010915 0.01060925 0.01042025 0.0102365 0.01064975 0.0103405
% 0.020763 0.01901375 0.0202355 0.0200455 0.019887 0.0197235 0.0196475 0.019526 0.01945525 0.01937175 0.01930375
% 0.046308 0.043764 0.04148775 0.039605 0.03913975 0.03896125 0.03857775 0.03840675 0.0384885 0.03815075 0.03825275
% 0.07993975 0.07768025 0.0795445 0.076165 0.07424175 0.07255125 0.071874 0.07258975 0.07149325 0.07097525 0.0711055
% 0.154599 0.14310975 0.158499 0.1517245 0.15214625 0.1471655 0.15000825 0.145699 0.15078325 0.14501275 0.14758125
% 0.3194115 0.2892905 0.32848075 0.322779 0.31595775 0.3020465 0.2965095 0.299597 0.297074 0.299272 0.29074225